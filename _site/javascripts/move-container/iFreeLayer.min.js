$.fn.iFreeLayer=function(n){var t=$(this),o=$.extend({},{parent:window},n);return o.parent=$(o.parent),{setup:function(){var n=this;this.$container=t;var a=this.$container.find(".block");this.containerX=0,this.containerY=0,this.containerW=0,this.containerH=0;var e=0,i=0,r=0,c=0;this.windowH=$(window).height(),this.windowW=$(window).width(),this.borderWidth=30,this.$container.on("mousedown",function(t){n.containerX="auto"==n.$container.css("left")?n.windowW-parseInt(n.$container.css("right"))-n.containerW:parseInt(n.$container.css("left")),n.containerY="auto"==n.$container.css("top")?n.windowH-parseInt(n.$container.css("bottom"))-n.containerH:parseInt(n.$container.css("top")),r=t.pageX,c=t.pageY,n.$container.css({top:n.containerY,right:"auto",bottom:"auto",left:n.containerX}),n.$container.on("mousemove",function(t){e=t.pageX-r,i=t.pageY-c,n.containerX+=e,n.containerY+=i,n.$container.css({top:n.containerY,right:"auto",bottom:"auto",left:n.containerX}),r=t.pageX,c=t.pageY,t.stopPropagation()}),t.stopPropagation()}),this.$container.on("mouseup",function(){n.$container.off("mousemove")}),a.on("mousedown",function(t){n.containerW=parseInt(n.$container.css("width")),n.containerH=parseInt(n.$container.css("height")),n.containerX="auto"==n.$container.css("left")?n.windowW-parseInt(n.$container.css("right"))-n.containerW:parseInt(n.$container.css("left")),n.containerY="auto"==n.$container.css("top")?n.windowH-parseInt(n.$container.css("bottom"))-n.containerH:parseInt(n.$container.css("top")),r=t.pageX,c=t.pageY,n.prepareStatus($(this).data("dir"));var a=$(this).data("dir");o.parent.on("mousemove",function(t){e=t.pageX-r,i=t.pageY-c,n.drag(a,{dx:e,dy:i}),r=t.pageX,c=t.pageY,t.stopPropagation()}),t.stopPropagation()}),o.parent.on("mouseup",function(){o.parent.off("mousemove")})},prepareStatus:function(n){var t=this,o=t.windowW-t.containerX-t.containerW,a=t.windowH-t.containerY-t.containerH;1==n?t.$container.css({top:"auto",right:"auto",bottom:a,left:t.containerX}):2==n?t.$container.css({top:"auto",right:"auto",bottom:a,left:t.containerX}):3==n?t.$container.css({top:t.containerY,right:"auto",bottom:"auto",left:t.containerX}):4==n?t.$container.css({top:t.containerY,right:"auto",bottom:"auto",left:t.containerX}):5==n?t.$container.css({top:t.containerY,bottom:"auto"}):6==n?t.$container.css({top:t.containerY,right:o,bottom:"auto",left:"auto"}):7==n?t.$container.css({top:t.containerY,right:o,bottom:"auto",left:"auto"}):8==n&&t.$container.css({top:"auto",right:o,bottom:a,left:"auto"})},drag:function(n,t){var o=this;switch(n){case 1:o.containerW=o.containerW+t.dx,o.containerH=o.containerH-t.dy,o.$container.css({height:o.containerH});break;case 2:o.containerW=o.containerW+t.dx,o.containerH=o.containerH-t.dy,o.$container.css({width:o.containerW,height:o.containerH});break;case 3:o.containerW=o.containerW+t.dx,o.containerH=o.containerH-t.dy,o.$container.css({width:o.containerW});break;case 4:o.containerW=o.containerW+t.dx,o.containerH=o.containerH+t.dy,o.$container.css({width:o.containerW,height:o.containerH});break;case 5:o.containerW=o.containerW+t.dx,o.containerH=o.containerH+t.dy,o.$container.css({height:o.containerH});break;case 6:o.containerW=o.containerW-t.dx,o.containerH=o.containerH+t.dy,o.$container.css({width:o.containerW,height:o.containerH});break;case 7:o.containerW=o.containerW-t.dx,o.containerH=o.containerH+t.dy,o.$container.css({width:o.containerW});break;case 8:o.containerW=o.containerW-t.dx,o.containerH=o.containerH-t.dy,o.$container.css({width:o.containerW,height:o.containerH})}}}};